<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scripts for RNA-seq and ChIP-seq analysis primer • basicBioinformaticsRNI2022</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Scripts for RNA-seq and ChIP-seq analysis primer">
<meta property="og:description" content="basicBioinformaticsRNI2022">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93043521-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93043521-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">basicBioinformaticsRNI2022</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/scripts.html">Scripts for RNA-seq and ChIP-seq analysis primer</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jianhong/genomictools" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Scripts for RNA-seq and ChIP-seq analysis primer</h1>
                        <h4 data-toc-skip class="author">Jianhong Ou</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jianhong/genomictools/blob/HEAD/vignettes/scripts.Rmd" class="external-link"><code>vignettes/scripts.Rmd</code></a></small>
      <div class="hidden name"><code>scripts.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="learning-objectives">Learning Objectives:<a class="anchor" aria-label="anchor" href="#learning-objectives"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>pipeline: kallisto and Salmon + tximport + DESeq2 for RNA-seq</p></li>
<li><p>pipeline: bwa + MACS2 for ChIP-seq</p></li>
</ol>
<p>For more information please refer to the <a href="https://github.com/jianhong/genomictools/blob/master/inst/extdata/BasicBioinformaticsRNAseqChIPseqPrimer.pdf" class="external-link">slides</a></p>
</div>
<div class="section level2">
<h2 id="set-up">Set-up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>All the materials used in this workshop is included in <a href="https://www.docker.com/" class="external-link">Docker</a> file: <a href="https://hub.docker.com/repository/docker/jianhong/genomictools" class="external-link">jianhong/genomictools</a></p>
<p>Before we start, please download Docker and install Docker Desktop.</p>
<div class="section level3">
<h3 id="install-docker">Install docker<a class="anchor" aria-label="anchor" href="#install-docker"></a>
</h3>
<p>Once the docker installed on you system, please try to run the following code in a terminal. This script will get the latest version of docker container for this workshop.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> docker</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull jianhong/genomictools:latest</span></code></pre></div>
<p>Change the docker Memory Resources to &gt;= 5G in the Preferences setting page of Docker. And then run the following code in a terminal.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">## set docker memory to &gt; 5G</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">## set docker memory to &gt; 5G ; !important</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">## RStudio server will not work for M1 chip MacBook.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> tmp4genomictools</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--memory</span> 5g <span class="at">-e</span> PASSWORD=123456 <span class="at">-p</span> 8787:8787 <span class="dt">\</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="va">${PWD}</span>/tmp4genomictools:/data <span class="dt">\</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  jianhong/genomictools:latest</span></code></pre></div>
<p>“docker run” will open port 8787 on your system. Now you can login rstudio in the container at <a href="http://localhost:8787" class="external-link uri">http://localhost:8787</a> with username “rstudio” and password “123456”. All the following steps are running in Rstudio “Terminal” or “Console”.</p>
</div>
</div>
<div class="section level2">
<h2 id="run-kallisto-and-salmon-for-rna-seq">Run kallisto and Salmon for RNA-seq<a class="anchor" aria-label="anchor" href="#run-kallisto-and-salmon-for-rna-seq"></a>
</h2>
<p>The sample files are packaged in basicBioinformaticsRNI2022 package and Docker container.</p>
<p>Now we will download the zebrafish cDNA files from ENSEMBL in order to build the Kallisto and Salmon transcript index. If you are doing rRNA depletion library, please download and merge the cDNA and ncDNA files from ENSEMBL to make the full transcriptome.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> RNAseq</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> ftp://ftp.ensembl.org/pub/release-105/fasta/danio_rerio/cdna/Danio_rerio.GRCz11.cdna.all.fa.gz</span></code></pre></div>
<p>Now we can build the transcriptome index. It will take some time and memory for full dataset. This is the reason why we need to set docker memory to &gt; 5G.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kallisto</span> index <span class="at">-i</span> danRer.GRCz11_transcrits.idx Danio_rerio.GRCz11.cdna.all.fa.gz</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">salmon</span> index <span class="at">-i</span> danRer.GRCz11_transcrits.salmon.idx <span class="at">-t</span> Danio_rerio.GRCz11.cdna.all.fa.gz</span></code></pre></div>
<p>The data are only a subset of the whole genome. We will only use genes in chromosome 4, 13, 16 and 21 to speed up the test run.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/jianhong/genomictools/master/inst/extdata/Danio_rerio.GRCz11.cdna.toy.fa.gz</span></code></pre></div>
<p>It will take several seconds to build the toy index.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kallisto</span> index <span class="at">-i</span> danRer.GRCz11_transcrits.toy.idx Danio_rerio.GRCz11.cdna.toy.fa.gz</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">salmon</span> index <span class="at">-i</span> danRer.GRCz11_transcrits.toy.salmon.idx <span class="at">-t</span> Danio_rerio.GRCz11.cdna.toy.fa.gz</span></code></pre></div>
<p>It’s time for quantifying the FASTQ files against our Kallisto index and Salmon index. We run both of them for comparison. For real data, you can select one of them.</p>
<p>Because our FASTQ files are single end reads, we need to set –single for kallisto. And we also need to give the fragment length and standard error of the length for kallisto.</p>
<p>For Salmon, now we can set library type to “A”.</p>
<p>In this example, we put “-t 2” and “-p 2” so we can use up to two processors in the bootstrapping. We set the bootstrapping by “-b 30” and “–numBootstraps 30”.</p>
<p>It will take several minutes for the sample data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the toy RNAseq data is saved in /home/rstudio/RNAseq folder</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create a link to current folder</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> /home/rstudio/RNAseq/fastq ./fastq</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mapping</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ablated and Uninjured are related with fastq file name</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> kallisto_quant</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> salmon_quant</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> rep <span class="kw">in</span> 1 2</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cond <span class="kw">in</span> Ablated Uninjured</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="ex">kallisto</span> quant <span class="at">-i</span> danRer.GRCz11_transcrits.toy.idx <span class="dt">\</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">-o</span> kallisto_quant/<span class="va">$cond</span>.rep<span class="va">$rep</span> <span class="dt">\</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">-b</span> 30 <span class="at">-t</span> 2 fastq/<span class="va">$cond</span>.rep<span class="va">$rep</span>.fastq.gz <span class="dt">\</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">--single</span> <span class="at">-l</span> 200 <span class="at">-s</span> 50</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="ex">salmon</span> quant <span class="at">-i</span> danRer.GRCz11_transcrits.toy.salmon.idx <span class="at">-l</span> A <span class="dt">\</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">-r</span> fastq/<span class="va">$cond</span>.rep<span class="va">$rep</span>.fastq.gz <span class="dt">\</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">--validateMappings</span> <span class="at">-p</span> 2 <span class="dt">\</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">-o</span> salmon_quant/<span class="va">$cond</span>.rep<span class="va">$rep</span> <span class="dt">\</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">--numBootstraps</span> 30 <span class="at">--seqBias</span> <span class="at">--gcBias</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="r-scripts-for-rnaseq">R scripts for RNAseq<a class="anchor" aria-label="anchor" href="#r-scripts-for-rnaseq"></a>
</h2>
<p>Here we give an example workflow for a differential expression (DE) analysis. The following code should be run in Console of Rstudio.</p>
<div class="section level3">
<h3 id="prepare-the-transcripts-to-genes-map-table">prepare the transcripts to genes map table<a class="anchor" aria-label="anchor" href="#prepare-the-transcripts-to-genes-map-table"></a>
</h3>
<p>We are trying to do gene level DE analysis. We need to aggregate the transcript level counts to gene level. We borrowed from the Sleuth documentation by retrieve ENSEMBL transcript id to gene id.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">biomaRt</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="va">tx2gene</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">species</span><span class="op">=</span><span class="st">"hsapiens"</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span>
  <span class="va">mart</span> <span class="op">&lt;-</span> <span class="fu">biomaRt</span><span class="fu">::</span><span class="fu">useMart</span><span class="op">(</span>biomart <span class="op">=</span> <span class="st">"ensembl"</span>, 
                           dataset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">species</span>, <span class="st">"_gene_ensembl"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span>
  <span class="va">t2g</span> <span class="op">&lt;-</span> <span class="fu">biomaRt</span><span class="fu">::</span><span class="fu">getBM</span><span class="op">(</span>attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ensembl_transcript_id"</span>, 
                                       <span class="st">"ensembl_gene_id"</span>,
                                       <span class="st">"external_gene_name"</span><span class="op">)</span>, mart <span class="op">=</span> <span class="va">mart</span><span class="op">)</span>
  <span class="va">t2g</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">t2g</span>, target_id <span class="op">=</span> <span class="va">ensembl_transcript_id</span>,
                       ens_gene <span class="op">=</span> <span class="va">ensembl_gene_id</span>, ext_gene <span class="op">=</span> <span class="va">external_gene_name</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">t2g</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">t2g</span> <span class="op">&lt;-</span> <span class="fu">tx2gene</span><span class="op">(</span><span class="st">"drerio"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">t2g</span>, n<span class="op">=</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p>The following codes are using tximport to import the transcripts counts and aggregate to gene level. Downstream are using DESeq2 to do gene level DE analysis.</p>
</div>
<div class="section level3">
<h3 id="run-tximport-deseq2-for-salmon-results">run tximport + DESeq2 for Salmon results<a class="anchor" aria-label="anchor" href="#run-tximport-deseq2-for-salmon-results"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tximport</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DESeq2</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"RNAseq/"</span><span class="op">)</span> <span class="co">## RNAseq is the folder where saved the salmon_quant and kallisto_quant</span>
<span class="op">(</span><span class="va">salmon_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"salmon_quant"</span>, <span class="st">"sf$"</span>, 
                     recursive <span class="op">=</span> <span class="cn">TRUE</span>, 
                     full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">txi.salmon</span> <span class="op">&lt;-</span> <span class="fu">tximport</span><span class="op">(</span><span class="va">salmon_files</span>, type <span class="op">=</span> <span class="st">"salmon"</span>, 
                       tx2gene <span class="op">=</span> <span class="va">t2g</span>, ignoreTxVersion<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">sampleTable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">".rep."</span>, <span class="st">""</span>, 
                                          <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="va">salmon_files</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sampleTable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">txi.salmon</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span>
<span class="va">dds.salmon</span> <span class="op">&lt;-</span> <span class="fu">DESeqDataSetFromTximport</span><span class="op">(</span><span class="va">txi.salmon</span>, <span class="va">sampleTable</span>, <span class="op">~</span><span class="va">condition</span><span class="op">)</span>
<span class="va">dds.salmon</span> <span class="op">&lt;-</span> <span class="fu">DESeq</span><span class="op">(</span><span class="va">dds.salmon</span><span class="op">)</span>
<span class="va">res.salmon</span> <span class="op">&lt;-</span> <span class="fu">results</span><span class="op">(</span><span class="va">dds.salmon</span><span class="op">)</span>
<span class="va">res.salmon</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">res.salmon</span><span class="op">$</span><span class="va">padj</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-tximport-deseq2-for-kallisto-results">run tximport + DESeq2 for kallisto results<a class="anchor" aria-label="anchor" href="#run-tximport-deseq2-for-kallisto-results"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">kallisto_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"kallisto_quant"</span>, <span class="st">"abundance.h5"</span>, 
                       recursive <span class="op">=</span> <span class="cn">TRUE</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">txi.kallisto</span> <span class="op">&lt;-</span> <span class="fu">tximport</span><span class="op">(</span><span class="va">kallisto_files</span>, type <span class="op">=</span> <span class="st">"kallisto"</span>, 
                         tx2gene <span class="op">=</span> <span class="va">t2g</span>, ignoreTxVersion<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">sampleTable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">".rep."</span>, <span class="st">""</span>, 
                                          <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="va">kallisto_files</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">sampleTable</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">txi.kallisto</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span>
<span class="va">dds.kallisto</span> <span class="op">&lt;-</span> <span class="fu">DESeqDataSetFromTximport</span><span class="op">(</span><span class="va">txi.kallisto</span>, 
                                         <span class="va">sampleTable</span>, <span class="op">~</span><span class="va">condition</span><span class="op">)</span>
<span class="va">dds.kallisto</span> <span class="op">&lt;-</span> <span class="fu">DESeq</span><span class="op">(</span><span class="va">dds.kallisto</span><span class="op">)</span>
<span class="va">res.kallisto</span> <span class="op">&lt;-</span> <span class="fu">results</span><span class="op">(</span><span class="va">dds.kallisto</span><span class="op">)</span>
<span class="va">res.kallisto</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">res.kallisto</span><span class="op">$</span><span class="va">padj</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-sleuth">run Sleuth<a class="anchor" aria-label="anchor" href="#run-sleuth"></a>
</h3>
<p>The following code is showing how to use sleuth to do DE analysis.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#BiocManager::install("pachterlab/sleuth")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sleuth</span><span class="op">)</span>
<span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"kallisto_quant"</span><span class="op">)</span>
<span class="va">s2c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>path<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="st">"kallisto_quant"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, 
                  sample<span class="op">=</span><span class="va">samples</span>, 
                  condition<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">".rep."</span>, <span class="st">""</span>, <span class="va">samples</span><span class="op">)</span><span class="op">)</span>
<span class="va">s2c</span>
<span class="va">so</span> <span class="op">&lt;-</span> <span class="fu">sleuth_prep</span><span class="op">(</span><span class="va">s2c</span>, <span class="op">~</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="va">condition</span>, target_mapping <span class="op">=</span> <span class="va">t2g</span><span class="op">)</span>
<span class="va">so</span> <span class="op">&lt;-</span> <span class="fu">sleuth_fit</span><span class="op">(</span><span class="va">so</span><span class="op">)</span>
<span class="co">## which_beta must be in the colname of design table.</span>
<span class="va">so</span> <span class="op">&lt;-</span> <span class="fu">sleuth_wt</span><span class="op">(</span><span class="va">so</span>, which_beta <span class="op">=</span> <span class="st">"conditionAblated"</span><span class="op">)</span>
<span class="fu">sleuth_live</span><span class="op">(</span><span class="va">so</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="scripts-for-chipseq">scripts for ChIPseq<a class="anchor" aria-label="anchor" href="#scripts-for-chipseq"></a>
</h2>
<div class="section level3">
<h3 id="prepare-index-file-for-bwa">prepare index file for bwa<a class="anchor" aria-label="anchor" href="#prepare-index-file-for-bwa"></a>
</h3>
<p>Run following code in Terminal panel of rstudio.</p>
<p>The sample data is located at “/home/rstudio/ChIPseq” folder. It is zebrafish H3 ChIP-seq data.</p>
<p>We will map the reads by BWA (Burrows-Wheeler Aligner). Compare to Bowtie2, BWA is a little slower but a bit more accurate and provides information on which alignments are trustworthy. The bwa-mem mode is generally recommended for high-quality queries. It is not limited by sequence reads size as bwa-backtrack and bwa-sw. Aligning reads with bwa-mem, there are two steps, build the index and do alignment. BWA indexes the genome with an FM index based on the Burrows-Wheeler Transform to keep memory requirements low for the alignment process.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">## change you working directory</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> /home/rstudio/ChIPseq /data/ChIPseq</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /data</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">## download the zebrafish GRCz11 genome from ENSEMBLE</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> ftp://ftp.ensembl.org/pub/release-105/fasta/danio_rerio/dna/Danio_rerio.GRCz11.dna.primary_assembly.fa.gz</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">## build the index</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">## -p: prefix for all index files</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">bwa</span> index <span class="at">-p</span> GRCz11 Danio_rerio.GRCz11.dna.primary_assembly.fa.gz</span></code></pre></div>
<p>The data are only a subset of the whole genome. We will only use genes in chromosome 4, 13, 16 and 21 to speed up the test run.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/jianhong/genomictools/master/inst/extdata/Danio_rerio.GRCz11.dna.toy.fa.gz</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">## the following step will take about 3min</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">bwa</span> index <span class="at">-p</span> GRCz11.toy Danio_rerio.GRCz11.dna.toy.fa.gz</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-fastqc-mapping-and-macs2">Run fastQC, mapping and MACS2<a class="anchor" aria-label="anchor" href="#run-fastqc-mapping-and-macs2"></a>
</h3>
<p>We will the scripts in a bash loop. The samples are from two uninjured and two ablated fish heart tissue. We use fastQC to check the quality of raw reads. The results will saved to “fastqc” folder. You can go through the results by click the index.html file in each sub-folder. We will perform alignment on the single-end reads. For more information on BWA and its functionality please refer to the <a href="http://bio-bwa.sourceforge.net/bwa.shtml" class="external-link">user manual</a>. <a href="https://github.com/macs3-project/MACS" class="external-link">MACS2</a> will be used to call the peaks.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="va">group</span><span class="op">=</span><span class="va">(</span>Ablated Ablated Uninjured Uninjured<span class="va">)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="va">tag</span><span class="op">=</span><span class="va">(</span>Ablated.rep1 Ablated.rep2 Uninjured.rep1 Uninjured.rep2<span class="va">)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="va">species</span><span class="op">=</span>danRer11</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="va">prefix</span><span class="op">=</span>bwa</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="dt">{</span><span class="dv">0</span><span class="dt">..</span><span class="dv">3</span><span class="dt">}</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">## fastQC</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> fastqc/<span class="va">${group</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="ex">fastqc</span> <span class="at">-o</span> fastqc/<span class="va">${group</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="at">-t</span> 2 <span class="dt">\</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>       fastq/<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.fastq.gz</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">## trim adapter, need trim_galore be installed, here we do not do this step</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># mkdir -p fastq.trimmed</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># trim_galore -q 15 --fastqc -o fastq.trimmed/${group[$i]} fastq/${tag[$i]}.fastq.gz</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">## mapping by bwa</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> sam</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">## -t: number of threads</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">## -M: mark shorter split hits as secondary, this is optional for Picard compatibility.</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">## &gt;: save alignment to a SAM file</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">## 2&gt;: save standard error to log file</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="ex">bwa</span> mem <span class="at">-M</span> <span class="at">-t</span> 2 GRCz11.toy <span class="dt">\</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>           fastq/<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.fastq.gz <span class="dt">\</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>           <span class="op">&gt;</span> sam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.sam <span class="dt">\</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>           <span class="dv">2</span><span class="op">&gt;</span> bwa.<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.log.txt</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">## convert sam file to bam and clean-up</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> bam</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co">## -q: skip alignments with MAPQ samller than 30.</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-bhS</span> <span class="at">-q</span> 30 sam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.sam <span class="op">&gt;</span> bam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.bam</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">## sort and index the bam file for quick access.</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> sort bam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.bam <span class="at">-o</span> bam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.srt.bam</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> index bam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.srt.bam</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co">## remove un-sorted bam file.</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> bam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.bam</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co">## we remove the duplicated by picard::MarkDuplicates. </span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> bam/picard</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="ex">picard</span> MarkDuplicates <span class="dt">\</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>       INPUT=bam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.srt.bam <span class="dt">\</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>       OUTPUT=bam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.srt.markDup.bam <span class="dt">\</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>       METRICS_FILE=bam/picard/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.srt.fil.picard_info.txt <span class="dt">\</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>       REMOVE_DUPLICATES=true ASSUME_SORTED=true VALIDATION_STRINGENCY=LENIENT</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> index bam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.srt.markDup.bam</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="co">## use deeptools::bamCoverage to generate bigwig files</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="co">## the bw file can be viewed in IGV</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> bw</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="ex">bamCoverage</span> <span class="at">-b</span> bam/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.srt.markDup.bam <span class="at">-o</span> bw/<span class="va">$prefix</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.bw <span class="at">--normalizeUsing</span> CPM</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="co">## call peaks by macs2</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> macs2/<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="co">## -g: mappable genome size</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="co">## -q: use minimum FDR 0.05 cutoff to call significant regions.</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="co">## -B: ask MACS2 to output bedGraph files for experiment.</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="co">## --nomodel --extsize 150: the subset data is not big enough (&lt;1000 peak) for</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="co">## macs2 to generate a model. We manually feed one.</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="co">## because we used toy genome, the genome size we set as 10M</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a><span class="ex">macs2</span> callpeak <span class="at">-t</span> bam/<span class="va">${prefix}</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span>.srt.markDup.bam <span class="dt">\</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>               <span class="at">-f</span> BAM <span class="at">-g</span> 10e6 <span class="at">-n</span> <span class="va">${prefix}</span>.<span class="va">$species</span>.<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="dt">\</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>               <span class="at">--outdir</span> macs2/<span class="va">${tag</span><span class="op">[</span><span class="va">$i</span><span class="op">]</span><span class="va">}</span> <span class="at">-q</span> 0.05 <span class="dt">\</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>               <span class="at">-B</span> <span class="at">--nomodel</span> <span class="at">--extsize</span> 150</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jianhong Ou.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
